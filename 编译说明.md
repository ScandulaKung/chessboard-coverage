# 8x8拼图游戏 - 编译说明

## 系统要求
- Windows 10/11
- MinGW-w64 或 Visual Studio 2019+
- SFML 2.5+

## 方法一：使用MinGW编译（推荐）

### 1. 安装依赖

#### 安装MinGW-w64
- 下载：https://www.mingw-w64.org/downloads/
- 或使用MSYS2：https://www.msys2.org/
- 确保g++在PATH中

#### 安装SFML
1. 访问：https://www.sfml-dev.org/download.php
2. 下载 **Windows 64-bit (GCC)** 版本
3. 解压到 `C:\SFML`（或其他路径）

### 2. 修改build.bat
编辑 `build.bat`，修改 `SFML_PATH` 为你的SFML安装路径：
```batch
set SFML_PATH=C:\SFML
```

### 3. 编译
双击运行 `build.bat`，或在命令行执行：
```batch
build.bat
```

### 4. 复制DLL文件
将以下文件从 `%SFML_PATH%\bin` 复制到exe所在目录：
- `sfml-graphics-2.dll`
- `sfml-window-2.dll`
- `sfml-system-2.dll`

### 5. 运行
双击 `puzzle_game_gui.exe` 运行

## 方法二：使用CMake（推荐用于Visual Studio）

### 方式A：使用编译脚本（最简单）

1. **修改 `build_cmake.bat`**
   - 编辑脚本，修改 `SFML_PATH` 为你的SFML安装路径
   - 默认使用 Visual Studio 2022 生成器
   - 可以修改 `BUILD_TYPE`（Debug 或 Release）

2. **运行脚本**
   ```batch
   build_cmake.bat
   ```
   脚本会自动：
   - 配置CMake
   - 编译项目
   - 复制DLL文件到exe目录

### 方式B：手动使用CMake

1. **安装CMake**
   - 下载：https://cmake.org/download/
   - 安装时选择"Add CMake to system PATH"

2. **配置和编译**
   ```bash
   mkdir build
   cd build
   cmake .. -G "Visual Studio 17 2022" -A x64 -DSFML_ROOT=C:\SFML-2_5_1
   cmake --build . --config Release
   ```

3. **运行**
   - 将SFML的DLL从 `C:\SFML-2_5_1\bin` 复制到 `build\Release` 目录
   - 运行生成的exe

## 方法三：使用Visual Studio

### 1. 安装SFML
下载Visual C++版本的SFML

### 2. 配置项目
1. 创建新的C++项目
2. 项目属性 -> C/C++ -> 常规 -> 附加包含目录：添加 `C:\SFML\include`
3. 项目属性 -> 链接器 -> 常规 -> 附加库目录：添加 `C:\SFML\lib`
4. 项目属性 -> 链接器 -> 输入 -> 附加依赖项：添加
   - `sfml-graphics.lib`
   - `sfml-window.lib`
   - `sfml-system.lib`

### 3. 编译
- 选择Release配置
- 生成 -> 生成解决方案

## 字体问题

程序会尝试加载以下字体：
1. `arial.ttf`（exe同目录）
2. `C:\Windows\Fonts\arial.ttf`
3. `C:\Windows\Fonts\msyh.ttc`

如果字体加载失败，程序仍可运行，但不会显示文字说明。

## 使用说明

- **空格键**：切换显示/隐藏解
- **关闭窗口**：退出程序

程序启动后会自动在后台求解拼图，求解完成后可以按空格键查看解。

## 故障排除

### 编译错误：找不到SFML
- 检查SFML路径是否正确
- 确认下载的是MinGW版本（不是Visual C++版本）

### 运行时错误：找不到DLL
- 将SFML的bin目录添加到系统PATH
- 或复制DLL到exe目录

### 运行时错误：无法定位程序输入点（ABI不兼容）
**错误信息示例：**
```
无法定位程序输入点 _ZNSt15basic_streambuf... 于动态链接库 sfml-system-2.dll上
```

**原因：**
这是C++ ABI（应用程序二进制接口）不兼容问题。SFML的DLL与你的程序使用了不同的编译器编译：
- 如果使用MinGW编译程序，必须使用MinGW版本的SFML DLL
- 如果使用Visual Studio编译程序，必须使用Visual C++版本的SFML DLL

**解决方法：**

1. **确认你的编译方式：**
   - 如果使用 `build.bat` 编译 → 使用的是MinGW
   - 如果使用Visual Studio或CMake（MSVC）编译 → 使用的是Visual C++

2. **下载匹配的SFML版本：**
   - MinGW编译：下载 **Windows 64-bit (GCC)** 版本
   - Visual Studio编译：下载 **Windows 64-bit (Visual C++ 2019/2022)** 版本
   - 下载地址：https://www.sfml-dev.org/download.php

3. **替换DLL文件：**
   - 删除项目目录中的旧DLL文件（`sfml-*.dll`）
   - 从正确版本的SFML的 `bin` 目录复制新的DLL文件到exe所在目录
   - 确保DLL版本与编译时使用的SFML版本一致

4. **重新编译（推荐）：**
   - 使用正确的SFML版本重新编译整个项目
   - 确保编译器和SFML版本匹配

### 程序无响应
- 求解可能需要一些时间，请耐心等待
- 如果长时间无响应，可能是无解，需要调整图块定义

